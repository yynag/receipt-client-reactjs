# 库存管理功能文档

## 功能概述

库存管理模块提供了完整的库存数据管理功能，支持数据的增删改查、批量导入导出等操作。

## 主要功能

### 📋 库存列表
- **显示字段**：ID、创建日期时间、App ID、设备ID、产品ID、使用状态、用户ID
- **操作按钮**：导出JSON、详情、删除
- **分页功能**：支持10/20/50/100条每页显示
- **排序功能**：支持按创建时间排序

### 🔍 筛选功能
- **创建时间范围**：支持选择日期时间段进行筛选
- **App ID**：下拉选择特定应用
- **App产品ID**：下拉选择特定产品
- **使用状态**：已使用/未使用筛选
- **关键词搜索**：支持ID、AppID、产品ID、设备ID的模糊搜索

### 📤 导出功能
1. **单个导出**：每行操作按钮中的"导出JSON"
   - 生成单个JSON文件
   - 自动ZIP打包下载
   - 文件名格式：`stock_[ID]_[时间戳].zip`

2. **批量导出**：选中多个项目后使用表格上方的"批量导出"
   - 支持多选批量导出
   - 每个库存项生成独立JSON文件
   - 所有文件打包为一个ZIP下载
   - 文件名格式：`stock_batch_export_[时间戳].zip`

### 📥 导入功能
- **文件格式**：仅支持JSON格式
- **支持格式**：
  - 单个JSON对象：`{ "id": "stock_1", ... }`
  - JSON数组：`[{ "id": "stock_1", ... }, { "id": "stock_2", ... }]`
- **上传方式**：拖拽或点击上传
- **处理方式**：
  - 自动解析JSON数据
  - 模拟导入到服务器
  - 显示导入结果统计
  - 成功后自动刷新列表

### 📝 详情查看
- **抽屉式详情页**：点击"详情"按钮显示
- **完整信息展示**：
  - 基本信息：ID、创建时间、更新时间、App ID、设备ID、产品ID
  - 状态信息：使用状态（带颜色标签）、用户ID
  - 原始数据：格式化显示rawData内容

### ➕ 新建库存
- **必填字段**：App ID、设备ID、产品ID
- **自动生成**：ID、创建时间、更新时间
- **默认状态**：使用状态为false（未使用）

### 🗑️ 删除功能
1. **单个删除**：每行操作按钮中的删除
2. **批量删除**：选中多个项目后使用表格上方的批量删除

## 数据模型

### Stock 接口定义
```typescript
interface Stock {
  id: string;                    // 库存唯一标识
  createdAt: string;             // 创建时间 (ISO字符串)
  updatedAt: string;             // 更新时间 (ISO字符串)
  appId: string;                 // 应用ID
  deviceId: string;              // 设备ID
  productId: string;             // 产品ID
  used: boolean;                 // 使用状态
  userId?: string;               // 用户ID（可选）
  rawData: Record<string, unknown>; // 原始数据
}
```

## API接口

### Mock API 方法
- `getFilterOptions()` - 获取筛选选项
- `getList(params)` - 获取库存列表（支持分页和筛选）
- `create(data)` - 创建新库存项
- `delete()` - 删除库存项
- `batchDelete()` - 批量删除
- `importFromJson(jsonData)` - 从JSON导入数据

## 技术实现

### 使用技术栈
- **UI组件**：Ant Design Pro Components (ProTable)
- **文件处理**：jszip (ZIP压缩)、file-saver (文件下载)
- **状态管理**：React Hooks
- **数据模拟**：Mock API接口

### 关键特性
- ✅ **响应式设计**：适配各种屏幕尺寸
- ✅ **批量操作**：支持多选和批量处理
- ✅ **文件上传**：拖拽上传，支持格式验证
- ✅ **数据持久化**：表格状态本地存储
- ✅ **错误处理**：完整的错误提示和异常处理
- ✅ **加载状态**：所有异步操作都有加载指示器

## 使用说明

### 基本操作流程
1. **查看数据**：进入页面查看库存列表
2. **筛选数据**：使用顶部筛选框过滤数据
3. **查看详情**：点击"详情"查看完整信息
4. **导出数据**：选择单个或批量导出
5. **导入数据**：点击"导入JSON"上传文件
6. **管理数据**：使用新建和删除功能

### 批量操作指南
1. **选择项目**：勾选表格左侧的复选框
2. **批量导出**：点击表格上方的"批量导出"按钮
3. **批量删除**：点击表格上方的"批量删除"选项

### 文件导入注意事项
- 文件必须是有效的JSON格式
- 支持中文内容和特殊字符
- 大文件上传可能需要等待一段时间
- 导入失败会显示具体错误信息

## 文件结构
```
src/domains/admin/pages/stock/
├── index.tsx              # 主页面组件
└── README.md              # 功能文档

src/domains/admin/api/
└── stock.ts               # API接口定义
```

## 性能优化

### 已实现的优化
- **分页加载**：避免一次性加载大量数据
- **本地缓存**：筛选选项数据缓存
- **代码分割**：按需加载相关组件
- **防抖搜索**：搜索输入防抖处理

### 建议的优化方向
- 数据虚拟化（当数据量极大时）
- 服务端筛选和排序
- 缓存策略优化
- 文件上传进度显示

---

🎉 **库存管理模块已完成开发并集成到系统中！**